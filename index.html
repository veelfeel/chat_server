<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <input id="textMessage" type="text" placeholder="Введите сообщение" />
    <button id="sendButton" type="button">Отправить</button>
    <div id="chatBody"></div>

    <script>
      const sender_id = (Date.now() / 1000) | 0;

      const ws = new WebSocket("wss://chat-cpwa.onrender.com");
      ws.addEventListener("open", () => {
        console.log("we are connected");
      });

      ws.addEventListener("message", (e) => {
        const data = JSON.parse(e.data);
        if (sender_id !== data.sender_id) {
          const messageHtml = `<div>user ${data.sender_id}: ${data.message}</div>`;

          document
            .getElementById("chatBody")
            .insertAdjacentHTML("beforeend", messageHtml);
        }
      });

      document
        .getElementById("sendButton")
        .addEventListener("click", sendMessageToTheServer);

      function sendMessageToTheServer() {
        const message = document.getElementById("textMessage").value;
        const messageHtml = `<div>user ${sender_id}: ${message}</div>`;

        document
          .getElementById("chatBody")
          .insertAdjacentHTML("beforeend", messageHtml);

        const jsonData = { sender_id: sender_id, message: message };

        ws.send(JSON.stringify(jsonData));

        document.getElementById("textMessage").value = "";
      }
    </script>
  </body>
</html>
